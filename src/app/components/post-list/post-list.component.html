<!-- Loading Indicator -->
<div *ngIf="isLoading" class="p-6 text-center text-gray-500">
  <p>Loading posts...</p>
</div>

<!-- Error Message -->
<div *ngIf="errorMessage" class="p-6 text-center text-red-500">
  {{ errorMessage }}
</div>

<!-- Post Grid -->
<div *ngIf="!isLoading && !errorMessage" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-6 bg-gray-100">
  <div *ngFor="let item of postsWithCommentsAndReplies; let i = index"
    class="bg-white shadow-lg rounded-lg overflow-hidden hover:shadow-xl transition-shadow duration-300">

    <!-- Post Content -->
    <div class="p-6">
      <!-- View Mode -->
      <div *ngIf="!item.isEditing">
        <h3 class="text-xl font-bold text-gray-800 mb-3">{{ item.post.title }}</h3>
        <p class="text-sm text-gray-600 mb-2">👁️ Views: <span class="font-medium">{{ item.post.views }}</span></p>
        <p class="text-sm text-gray-600 mb-2">❤️ Likes: <span class="font-medium">{{ item.post.likesCount }}</span></p>
        <p class="text-sm text-gray-700">{{ item.post.content }}</p>

        <!-- Action Buttons -->
        <div class="mt-4 flex space-x-2">
          <button pButton icon="pi pi-pencil" class="p-button-sm" (click)="toggleEdit(i)"></button>
          <button pButton icon="pi pi-trash" class="p-button-sm p-button-danger" (click)="deletePost(item.post.postId)"></button>
        </div>
      </div>

      <!-- Edit Mode -->
      <div *ngIf="item.isEditing" class="space-y-3">
        <input type="text" pInputText [(ngModel)]="item.editData.title" class="w-full" placeholder="Post Title" />
        <textarea [(ngModel)]="item.editData.content" class="w-full" rows="3" placeholder="Post Content"></textarea>
        <div class="flex justify-end space-x-2">
          <button pButton label="Cancel" class="p-button-secondary p-button-sm" (click)="toggleEdit(i)"></button>
          <button pButton label="Save" class="p-button-sm" (click)="updatePost(i)"></button>
        </div>
      </div>
    </div>

    <!-- Comments Section -->
    <div *ngIf="item.comments.length > 0" class="border-t border-gray-200 p-6 bg-gray-50">
      <h4 class="text-lg font-semibold text-gray-700 mb-4">💬 التعليقات:</h4>

      <div *ngFor="let comment of item.comments" class="mb-4 p-4 bg-white rounded-md shadow-sm">
        <p class="text-sm text-gray-800"><strong>تعليق:</strong> {{ comment.comment.content }}</p>

        <!-- Replies -->
        <div *ngIf="comment.replies.length > 0" class="mt-3 pl-4 border-l-2 border-gray-300">
          <h5 class="text-sm font-medium text-gray-600 mb-2">↪️ الردود:</h5>
          <div *ngFor="let reply of comment.replies" class="text-sm text-gray-700">
            <span>↳ {{ reply.content }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Post Button -->
<div class="p-6">
  <button pButton label="Add Post" icon="pi pi-plus" (click)="createPost()"></button>
</div>